import{Q as R,R as k,S,a as $,b as z,c as A,d as F,f as j,i as L,j as N,l as W,n as p,p as B,q as D,t as y,u as m,y as q}from"./chunk-IQCAHYDB.js";import{a as h}from"./chunk-2VMXMS7J.js";function O(e){e||(D(O),e=p(m));let i=new z(n=>e.onDestroy(n.next.bind(n)));return n=>n.pipe(W(i))}function P(e,i){!i?.injector&&D(P);let n=i?.injector??p(y),t=new F(1),r=S(()=>{let d;try{d=e()}catch(a){k(()=>t.error(a));return}k(()=>t.next(d))},{injector:n,manualCleanup:!0});return n.get(m).onDestroy(()=>{r.destroy(),t.complete()}),t.asObservable()}function M(e,i,n){!i&&D(e);let t=i??p(y);return n?B(t,n):t}function v(e,...i){let[n,t,r,d,a]=J(i);if(n){let u=null;return r instanceof m?u=r:u=M(v,r).get(m),n.pipe(O(u)).subscribe(s=>{let l=()=>{e.update(o=>{if(!x(o))return t?.(o,s)||s;if(!x(s)){let w=t?t(o,s):s;return x(w)?h(h({},o),w):w}return h(h({},o),t?.(o,s)||s)})};d?k(l):l()})}if(a){let u=r instanceof y?M(v,r):void 0;return S(()=>{e.update(s=>x(s)?h(h({},s),a()):a())},{allowSignalWrites:!0,injector:u})}return{with(...u){if(!this.subscription)this.subscription=new $;else if(this.subscription.closed)return console.info("[ngxtension connect] ConnectedSignal has been closed."),this;return this.subscription.add(v(e,...u,r,d)),this},subscription:null}}function J(e){return e.length>3?[e[0],e[1],e[2],e[3],null]:e.length===3?typeof e[2]=="boolean"?j(e[0])?[e[0],null,e[1],e[2],null]:[null,null,e[1],e[2],e[0]]:[e[0],e[1],e[2],!1,null]:e.length===2?typeof e[1]=="boolean"?[null,null,e[0],e[1],null]:typeof e[1]=="function"?[e[0],e[1],null,!1,null]:[e[0],null,e[1],!1,null]:j(e[0])?[e[0],null,null,!1,null]:typeof e[0]=="function"?[null,null,null,!1,e[0]]:[null,null,e[0],!1,null]}function x(e){return typeof e=="object"&&e!==void 0&&e!==null&&!Array.isArray(e)}function de(e){let i=p(m),n=p(y),{initialState:t,sources:r=[],lazySources:d=[],actionSources:a={},selectors:u=()=>({}),effects:s=()=>({})}=e,l=q(t),o=l.asReadonly(),w=P(l),E=!1,C=[],I=o;G(l,r);for(let[c,f]of Object.entries(a))if(j(f))H(o,w,c,i,f,C);else{let b=new A,T=f(o,b).pipe(N());v(l,T),H(o,w,c,i,b,C,T)}for(let c in t)Object.defineProperty(o,c,{value:R(()=>o()[c])});for(let[c,f]of Object.entries(u(I)))Object.defineProperty(o,c,{value:R(f)});for(let[c,f]of Object.entries(s(I)))console.warn("The 'effects' configuration in signalSlice is deprecated. Please use standard signal effects outside of signalSlice instead."),Object.defineProperty(I,c,{value:S(b=>{let g=f();g&&b(()=>g())})});i.onDestroy(()=>{C.forEach(c=>c.complete())});let U=()=>{E||(E=!0,G(l,d,n,!0))};return new Proxy(I,{get(c,f,b){return U(),Reflect.get(c,f,b)},apply(c,f,b){return U(),Reflect.apply(c,f,b)}})}function G(e,i,n,t=!1){for(let r of i)j(r)?v(e,r,n,t):v(e,r(e.asReadonly()),n,t)}function H(e,i,n,t,r,d,a){Object.defineProperties(e,{[n]:{value:u=>j(u)?new Promise((s,l)=>{u.pipe(O(t)).subscribe({next:o=>{r.next(o)},error:o=>{r.error(o),l(o)},complete:()=>{r.complete(),s(e())}})}):(a&&a.pipe(O(t)).subscribe(),new Promise(s=>{i.pipe(L(1)).subscribe(l=>{s(l)}),r.next(u)}))},[`${n}$`]:{value:r.asObservable()}}),d.push(r)}export{de as a};
